\input{../../style.tex}

\title{Additive Combinatorics}
\author{Jacob Denson}

\begin{document}

\pagenumbering{gobble}

\maketitle

\tableofcontents

\pagenumbering{arabic}

\chapter{Additive Combinatorics}

Additive combinatorics studies the structure of \emph{additive sets}, i.e. subsets of an additive group, often the set of integers. Unlike the methods of number theory, which look at particular number theoretic sets with a strong amount of structure (e.g. the set of primes, the set of squares) we look at more general sets with less structure.

Since we will almost always deal with subsets of the integers rather than subsets of the reals, for notational convenience we let the intervals $[a,b]$, $[a,b)$, $(a,b)$, and $(a,b]$ denote the family of \emph{integers} in these intervals rather than the family of all reals in these intervals, unless otherwise specified.

\section{Sum Sets}

If $A$ and $B$ are subsets of an additive group $G$, then
%
\[ \max(\#(A),\#(B)) \leq \#(A + B) \leq \#(A) \#(B). \]
%
Accounting for symmetry in expressions when $A = B$, we have
%
\[ \#(A) \leq \#(A + A) \leq \frac{\#(A) (\#(A) + 1)}{2}. \]
%
More generally, a simple stars and bars argument shows that
%
\[ |A| \leq |A^{\oplus n}| \leq {{|A| + n - 1}\choose{n}}, \]
%
where $A^{\oplus n}$ denotes the $n$-fold sumset. These bounds are all sharp, e.g. if $\#(A) = 1$. It is a general heuristic that for the `average' pair of sets $A$ and $B$, the quantity $\#(A + B)$ is much more likely to be close to $\#(A) \#(B)$, than to $\max(\#(A),\#(B))$.

\begin{example}
    Let $A$ and $B$ to be sets of size $N$ and $M$ choosen uniformly at random from $[0,1]$. Then
    %
    \[ \PP(\#(A + B) = \#(A) \#(B)) = 1. \]
    %
    If we let $A = \{ X_1,\dots, X_N \}$ and $B = \{ Y_1, \dots, Y_M \}$, then the variables $\{ X_i, Y_j \}$ are independant and uniformly distributed on $[0,1]$, and for any distinct indices $(i_1,j_1)$ and $(i_2,j_2)$,
    %
    \[ \PP(X_{i_1} + Y_{j_1} = X_{i_2} + Y_{j_2}) = 0. \]
    %
    Thus for any distinct pairs $(i_1,j_1)$ and $(i_2,j_2)$, $\PP(X_{i_1} + Y_{j_1} = X_{i_2} + Y_{j_2}) = 0$. Taking a union bound shows that with probability one, the elements $\{ X_i + Y_j \}$ are distinct for all $i$ and $j$, and so $\PP(\#(A + B) = NM) = 1$.
\end{example}

\begin{example}
    Let $A$ and $B$ be subsets of $\ZZ_N$ with each element in $A$ and $B$ uniformly chosen with probability $K/N$. Then for each $n \in \ZZ / N \ZZ$,
    %
    \begin{align*}
        \PP(n \in A + B) &= \sum_{i = 0}^{N-1} \PP(i \in A) \PP(n-i \in B)\\
        &\ \ \ \ - \sum_{i \neq j} \PP(i \in A) \PP(n-i \in B) \PP(j \in A) \PP(n-j \in B)\\
        &\geq K^2/N - K^4/N^2.
    \end{align*}
    %
    Thus $\EE(\#(A + B) \geq K^2 - K^4/N = \EE(\#(A) \#(B)) - K^4/N$. Markov's inequality implies that with high probability, $\#(A + B) \approx \#(A) \#(B)$ if $K \ll N^{1/2}$.
\end{example}

Thus if $\#(A+B)$ is relatively small, it is natural to expect there to be some structure to the sets $A$ and $B$. A fundamental problem in additive combinatorics is to characterize this structure, the \emph{inverse set problem}. If $\#(A + B) = \max(\#(A), \#(B))$, then $A$ and $B$ have maximal additive structure, and in this case we have a strong characterization of this structure.

\begin{theorem}
    Suppose $A$ and $B$ are finite additive sets. Then the following are equivalent:
    %
    \begin{enumerate}
        \item $\#(A + B) = \#(A)$.
        \item $\#(A - B) = \#(A)$.
        \item $\#(A + B^{\oplus n} - B^{\oplus m}) = \#(A)$ for some $(n,m) \neq 0$.
        \item $\#(A + B^{\oplus n} - B^{\oplus m}) = \#(A)$ for all $n,m$.
        \item There exists a finite subgroup $H$ of $G$ such that $A$ is a union of cosets in $G/H$, and $B$ is contained in a single coset of $G/H$. 
    \end{enumerate}
\end{theorem}
\begin{proof}
    Assume $0 \in B$ without loss of generality. Then 1. implies $A + B = A$, so for each $a \in A$, $b \in B$, $a + b \in A$. But this means that $B$ is a subset of the \emph{symmetry group} of $A$, i.e. $\text{Sym}(A) = \{ x \in G : A + x = A \}$. If $v,w \in G$, $w \in A$, and $v - w \in \text{Sym}(A)$, then $v = w + (v - w) \in A + (v - w) = A$. Thus $A$ is a union of cosets. Thus we have shown 1. implies 5. A similar argument shows 2. and 3. imply 5., and the remaining implications are simple to verify.
\end{proof}

\begin{corollary}
    If $A = A + A$, then $A$ is a subgroup of $G$.
\end{corollary}

If we have an exact equality $\#(A + B) = \#(A) \#(B)$, we do not have quite as much structure but we note the condition is equivalent to the following properties:
%
\begin{itemize}
    \item $\#(A + B) = \#(A) \#(B)$.
    \item $\#(A - B) = \#(A) \#(B)$.
    \item $\# \{ (a_1,a_2,b_1,b_2) \in A^2 \times B^2 : a_1 + b_1 = a_2 + b_2 \} = \#(A) \#(B)$.
    \item $\# \{ (a_1,a_2,b_1,b_2) \in A^2 \times B^2 : a_1 - b_1 = a_2 - b_2 \} = \#(A) \#(B)$.
    \item $(A - A) \cap (B - B) = \{ 0 \}$.
    \item For each $c \in A + B$, $\#((A - c) \cap B) = 1$.
    \item For each $c \in B - A$, $\#((A + c) \cap B) = 1$.
\end{itemize}

\begin{remark}
    It is not always true that $\#(A + B) = \#(A - B)$. For instance, if $A = \{ 0, 1, 3 \}$ in $\ZZ$ then $A + A = \{ 0,1,2,3,4,6 \}$ whereas $A - A = \{ -1,0,1,2,3 \}$. Thus in this case $\#(A + A) = 6$ but $\#(A - A) = 5$.
\end{remark}

\begin{theorem}
    Let $A$ and $B$ be additive sets in a finite group $G$. If $\#(A) + \#(B) > \#(G)$< then $A + B = G$.
\end{theorem}
\begin{proof}
    Fix $x \in G$. If $x \not \in A + B$, then for each $a \in A$, $x - a \not \in B$. Thus $\#(B) \leq \#(G) - \#(A)$, which implies $\#(A) + \#(B) \leq \#(G)$, giving a contradiction.
\end{proof}

\begin{theorem}
    Fix $A,B \subset [0,N]$ with $0,N \in A$, and suppose that
    %
    \[ \#(A) + \#(B) \geq N + 3. \]
    %
    Then $\#(A + B) \geq N + \#(B)$.
\end{theorem}
\begin{proof}
    Let $\phi_N: \ZZ \to \ZZ_N$ denote the canonical homomorphism. Then $\#(\phi_N(A)) = \#(A) - 1$, and $\#(\phi_N(B)) \geq \#(B) - 1$. Thus
    %
    \[ \#(\phi_N(A)) + \#(\phi_N(B)) \geq \#(A) + \#(B) - 2 \geq N + 1. \]
    %
    The last theorem implies that $\phi_N(A + B) = \phi_N(A) + \phi_N(B) = \ZZ_N$. For each $n \in \ZZ_N$, let $\mu_n = \#((A + B) \cap \phi_N^{-1}(n))$. Then
    %
    \[ \#(A + B) = \sum_{n \in \ZZ_N} \mu_n. \]
    %
    Our calculations above show that $\mu_n \geq 1$ for each $n \in \ZZ_N$. Furthermore, for each $b \in B$, $b$ and $b+N$ are elements of $A + B$ with $\phi_N(b) = \phi_N(N + b) = b + N \ZZ$. Thus $\mu_{b + N \ZZ} \geq 2$ for each $b \in B$. But then we conclude that
    %
    \begin{align*}
        \#(A + B) &= \sum_{n \in \phi_N(B)} \mu_n + \sum_{n \not \in \phi_N(B)} \mu_n\\
        &\geq \sum_{n \in \phi_N(B)} 2 + \sum_{n \not \in \phi_N(B)} 1\\
        &= 2 \#(\phi_N(B)) + \#(\ZZ_N - \phi_N(B))\\
        &= N + \#(\phi_N(B)).
    \end{align*}
    %
    This completes the proof provided that $B$ does not contain both $0$ and $N$. In this case, if we let $B' = B - \{ N \}$, then the last case implies that $\#(A + B') \geq N-1 + \#(B)$, and then $(A + B) - (A + B')$ is nonempty, containing $2N$, and so $\#(A + B) \geq N + \#(B)$.
\end{proof}


\section{Doubling Constant}

Another way to measure the arithmetic structure of sets is via the \emph{doubling constant}
%
\[ \sigma[A] = \frac{|A + A|}{|A|}. \]
%
If $K$ is small, we have lots of arithmetic structure, whereas if $K$ is large, we have little structure. Similarily we define the \emph{difference constant}
%
\[ \delta[A] = \frac{|A - A|}{|A|}. \]
%
We have already calculated that that
%
\[ 1 \leq \sigma[A] \leq (|A| + 1)/2 \]
%
and it is also easy to see that
%
\[ 1 \leq \delta[A] \leq (|A| - 1)/2 + \frac{1}{|A|} \]
%
which follows from the fact that $|A - A| \leq |A|^2 - |A| + 1$. A set which achieve this upper bound (for either the doubling or difference constant, since they are equivalent) is called a \emph{Sidon set}.

\begin{theorem}
    Let $A$ be an additive set. Then any subset of $A$ can have doubling constant at most $\sqrt{\sigma(A)|A|/2}$, and any Sidon set in $A$ has cardinality at most $\sqrt{2\sigma(A) |A|}$.
\end{theorem}
\begin{proof}
    If $|B| \geq c |A|$, then $|B + B| \leq |A| \sigma(A) \leq |B|/c \sigma(A)$ so $\sigma(B) \leq \sigma(A)/c$. $\sqrt{2} \cdot \sigma(A)^{1/2} |A|^{1/2}/|A|^{1/2}$
\end{proof}

The doubling constant behaves poorly under taking unions, except if one of the sets is very small with respect to the other set.

\begin{example}
    Find sets $A$ and $B$ each of cardinality $N$, with $\sigma(A) \leq 2$, $\sigma(B) \leq 2$, but $\sigma(A \cup B) = N/2$. TODO
\end{example}

On the other hand, if $\delta(A) = 1$ or equivalently, $\sigma(A) = 1$, then $A$ is a single coset of $G/H$, where $H$ is a finite subgroup of $G$. If $A + A = A$, then we actually have $A = H$. An important heuristic is that if $\sigma(A)$ is close to one, then $A$ is `close' to being a subgroup of $G$; we think of them as \emph{approximate groups}. On the other hand, we have yet to obtain tools to analyze the structure of sets $A$ with $\sigma(A)$ close to $(|A| + 1)/2$, i.e. `approximately Sidon sets'.

\section{Ruzsa Distance}

For two additive sets $A$ and $B$ we let
%
\[ d(A,B) = \log \left( \frac{|A-B|}{|A|^{1/2}|B|^{1/2}} \right). \]
%
This is known as the \emph{Ruzsa distance} between the two sets. Indeed, the distance is a non-negative, symmetric function and obeys the triangle inequality
%
\[ d(A,C) \leq d(A,B) + d(B,C) \]
%
which is equivalent to the fact that
%
\[ |A-C| \leq \frac{|A-B||B-C|}{|B|} \]
%
which follows from the identity that $a - c = (a - b) + (b - c)$ for any $b \in B$. The only problem is that we do not have $d(A,A) = 0$ for all sets $A$. In fact, we know that $d(A,A) = 0$ precisely when $A$ is a coset with respect to some finite subgroup $H$ of $G$.

The \emph{additive energy} $E(A,B)$ between two sets $A$ and $B$ is the number of solutions to the equation $a_1 + b_1 = a_2 + b_2$. Then
%
\[ |A||B| \leq E(A,B) \leq |A| |B| \min(|A|,|B|). \]
%
The lower bound follows because there are always at least this many trivial solutions, and the upper bound follows because given any three values in the equation, the fourth is always uniquely determined.

\begin{lemma}
    Let $A$ and $B$ be additive sets. Then
    %
    \[ |A||B| = \sum_{x \in A + B} |A \cap (x - B)| = \sum_{y \in A - B} |A \cap (B + y)| \]
    %
    and
    %
    \begin{align*}
        E(A,B) &= \sum_{x \in A + B} |A \cap (x - B)|^2\\
        &= \sum_{y \in A-B} |A \cap (B + y)|^2\\
        &= \sum_{z \in (A - A) \cap (B - B)} |A \cap (z + A)||B \cap (z + B)|.
    \end{align*}
\end{lemma}

\section{The $e$-transform}

In general, the bound $\#(A + B) = \max(\#(A),\#(B))$ holds only if $A$ is a coset and $B$ is a union of cosets of a finite group $H$ of the ambient group $G$. In particular, in a group containing no nontrivial finite subgroups, like $\ZZ$ or $\ZZ_p$, this can only occur $A$ or $B$ is a singleton. A natural question to ask is what the minimum size of $\#(A + B)$ is if $A$ is \emph{not} a singleton. A useful construction in such a setting is the \emph{$e$-transform}.

Given two sets $A$ and $B$, and given $e \in A - B$, we set
%
\[ A_e = A \cup (B + e) \]
%
and
%
\[ B_e = B \cap (A - e). \]
%
If $C = B \smallsetminus (A - e)$, then $A_e$ is the disjoint union of $A$ and $C + e$. In particular, this means $\#(A_e) + \#(B_e) = \#(A) + \#(B)$; we are, in some sense, rearranging the elements of $A \cup B$ via a single translation. Moreover,
%
\begin{align*}
    A_e + B_e &= (A \cup (B + e)) + (B \cap (A - e))\\
    &= (A + (B \cap (A - e))) \cup ((B + e) + (B \cap (A - e)))\\
    &\subset (A + B) \cup ((B + e) + (A - e)) = A + B.
\end{align*}
%
Moreover, $\#(A_e) \geq \#(A)$ and $\#(B_e) \leq \#(B)$, with equality only being obtained if $A \subset B + e$.

\begin{lemma}
    For any set $E$,
    %
    \begin{align*}
        |A_e \cap E| + |B_e \cap E| &= |A \cap E| + |B \cap E|\\
        &\quad + |((B + e) \smallsetminus A) \cap (E \smallsetminus (E + e))|\\
        &\quad - |((B + e) \smallsetminus A) \cap ((E + e) \smallsetminus E)|.
    \end{align*}
    %
    In particular, if $e \in \text{Sym}(E)$, then $\#(A_e \cap E) + \#(B_e \cap E) = \#(A \cap E) + \#(B \cap E)$.
\end{lemma}
\begin{proof}
    For any set $E \subset G$,
    %
    \begin{align*}
        |A_e \cap E| + |B_e \cap E| &= |A_e \cap E| + |(B_e + e) \cap (E + e)|\\
        &= |(A_e \cap E) \cup ((B_e + e) \cap (E + e))|\\
        &\quad + |A_e \cap E \cap (B_e + e) \cap (E + e)|\\
        &= |A \cap E| + |B \cap E|\\
        &\quad + |((B + e) \smallsetminus A) \cap (E \smallsetminus (E + e))|\\
        &\quad - |((B + e) \smallsetminus A) \cap ((E + e) \smallsetminus E)|. \qedhere
    \end{align*}
\end{proof}

Let us use the $e$-transform to improve the lower bound for sum sets over the integers, using the fact that the integers are ordered.

\begin{lemma}
    If $A,B \subset \ZZ$, then
    %
    \[ \#(A + B) \geq \#(A) + \#(B) - 1. \]
\end{lemma}
\begin{proof}
    Let $e = \max(A) - \min(B)$. Then
    %
    \[ A_e = A \cup (B + e) \]
    %
    is the disjoint union of $A \smallsetminus \{ \max(A) \}$, $\{ \max(A) \}$, and $(B + e) \smallsetminus \{ \max(A) \}$, and
    %
    \[ B_e = B \cap (A - e) = \{ \min(B) \}. \]
    %
    Thus
    %
    \begin{align*}
        \#(A + B) &\geq \#(A_e + B_e)\\
        &= \#(A_e)\\
        &= (\#(A) - 1) + (\#(B) - 1) + 1\\
        &= \#(A) + \#(B) - 1. \qedhere
    \end{align*}
\end{proof}

We have a characterization of when this inequality is sharp.

\begin{lemma}
    Let $A$ and $B$ be additive sets in $\ZZ$. Then $\#(A + B) = \#(A) + \#(B) - 1$ if and only if $A$ and $B$ are arithmetic progressions with the same step size.
\end{lemma}
\begin{proof}
    By translating $A$ and $B$ appropriately we may assume $\max(A) = \min(B) = 0$. Then if $e = 0$, then since $\#(A + B)$ is minimal,
    %
    \[ A + B = A_0 + B_0 = (A \cup B) + \{ 0 \}. \]
    %
    Write $A = \{ a_n < \dots < a_1 < 0 \}$ and $B = \{ 0 < b_1 < \dots < b_m \}$. It is simple to argue combinatorially that $a_1 + b_1 = 0$, that for $2 < i < m$, $a_1 + b_i = b_{i-1}$, and that for $2 < j < n$, $a_j + b_1 = a_{j-1}$. But this implies that $A$ and $B$ are precisely arithmetic progressions with the same step length.
\end{proof}

Now we exploit the fact that $\ZZ_p$ has no proper subgroups.

\begin{lemma}[Cauchy-Davenport Inequality]
    If $p$ is prime, and $A$ and $B$ are additive sets in $\ZZ_p$, then
    %
    \[ \#(A + B) \geq \min(\#(A) + \#(B) - 1, p). \]
\end{lemma}
\begin{proof}
    Assume $\#(B) \leq \#(A)$. We induct on $\#(B)$. If $\#(B) = 1$ the theorem is trivial. In general, if we can find $e \in A - B$ such that $\#(B_e) < \#(B)$, then induction implies
    %
    \[ \#(A + B) \geq \#(A_e + B_e) \geq \min(\#(A_e) + \#(B_e) - 1, p) = \min(\#(A) + \#(B) - 1, p). \]
    %
    On the other hand, if $\#(B_e) = \#(B)$ for all $e \in A - B$, then $B + e \subset A$. This means that $(A + B) - B \subset A$. In particular, $\#(A + B) \leq \#(A)$, which actually implies that $\#(A + B) = \#(A)$, that $A$ is a union of cosets of a subgroup of $\ZZ_p$, and that $B$ is a subset of a coset of this subgroup. Since $\ZZ_p$ has no nontrivial subgroups, this implies either $B$ is a singleton or $A = \ZZ_p$; in both of these cases the theorem is trivial.
\end{proof}

Again, aside from trivial examples the only way the Cauchy-Davenport inequality can be tight is if $A$ and $B$ are arithmetic progressions of the same step size.

\begin{lemma}
    Let $A$ and $B$ be additive sets in $\ZZ_p$ for some prime $p$, such that $\#(A), \#(B) \geq 2$, $\#(A + B) \leq p - 2$, and $\#(A + B) = \#(A) + \#(B) - 1$. Then $A$ and $B$ are arithmetic progressions of the same step size.
\end{lemma}
\begin{proof}
    Suppose first that $A$ is an arithmetic progression. Then $A = a + [0,n-1] \cdot v$ for some $v \in \ZZ_p$ and $n \geq 2$. Set $A' = a + [0,n-2] \cdot v$. Then $A + B = A' + (\{ 0, v \} + B)$, so
    %
    \begin{align*}
        (n-1) + \#(B) &= \#(A) + \#(B) - 1\\
        &= \#(A + B)\\
        &= \#([0,n-2] + (\{ 0, v \} + B))\\
        &\geq (n-1) + \#(\{ 0, v \} + B) - 1\\
        &\geq (n-2) + \#(\{ 0, v \} + B).
    \end{align*}
    %
    Thus $\#( \{ 0, v \} + B) \leq \#(B) + 1$. We cannot have $\{ 0, v \} + B = B$, since then $B = \ZZ_p$. Thus there is a unique $k \not \in B$ such that $B + \{ 0, v \} = B \cup \{ k \}$. But this means that $B = \{ k - v, \dots, k - mv \}$ for some $m$, which shows $B$ is an arithmetic progression with the same step size as $A$. By symmetry the claim we have just proven holds if we reverse $A$ and $B$.

    Now suppose instead that $A + B$ is an arithmetic progression. Let $C = - (\ZZ_p \ssm (A + B))$. Then $C$ is also an arithmetic progression with $\#(C) = p + 1 - \#(A) - \#(B) \geq 2$. Note that $B + C \subset -(\ZZ_p \ssm A)$, so that $\#(B + C) \leq p - \#(A) = \#(B) + \#(C) - 1$. The previous paragraph thus shows that $B$ is an arithmetic progression, and thus $A$ is an arithmetic progression.

    In general, we induct on $\#(B)$. If $\#(B) = 2$, then $B$ is an arithmetic progression and the theorem is trivial. In general, suppose we can find $e \in A - B$ such that $1 < \#(B_e) < \#(B)$. Then $A + B = A_e + B_e$, so by induction $A_e$ and $B_e$ are both arithmetic progressions with the same step length, so $A_e + B_e = A + B$ is an arithmetic progression, and thus $A$ and $B$ are also. Thus we may assume without loss of generality that $\#(B_e) = 1$ or $\#(B_e) = \#(B)$ for all $e \in A - B$.

    If $E = \{ e \in A - B: \#(B_e) = \#(B) \}$, then $B + E \subset A$, so by Cauchy-Davenport, $\#(E) \leq \#(A) - \#(B) + 1$. But $\#(A - B) \geq \#(A) + \#(B) - 1$, so by pidgeonholing there are at least $2 \#(B) - 2$ values $e \in A - B$ such that $\#(B_e) = 1$. Since $\#(B) \geq 3$, $2 (\#(B) - 1) \geq \#(B) + 1$, so further pidgeonholing allows us to find find distinct $e_1,e_2 \in A - B$ and $b \in B$ such that $B_{e_1} = B_{e_2} = \{ b \}$. Thus
    %
    \[ A + B = A_{e_1} + b = A_{e_2} + b. \]
    %
    Thus $A \cup (B + e_1) = A \cup (B + e_2)$. But $A \cap (B + e_1) = (b + e_1)$ and $A \cap (B + e_2) = (b + e_2)$, so $(B + e_1) \ssm (b + e_1) \subset B + e_2$. But this means that $B \ssm b \subset B + (e_2 - e_1)$, so comparing cardinalities, there exists $b' \in B$ such that $B \ssm b = (B \ssm b') + (e_2 - e_1)$. For each For each $x \in B$, let $k_x$ denote the largest integer such that for $0 \leq k \leq k_x$, $x + k(e_2 - e_1) \in B$. The inequality above implies that $x + k_x(e_2 - e_1) = b'$. But this means there is $m$ such that
    %
    \[ B = \{ b', b' - (e_2 - e_1), \dots, b' - (m-1)(e_2 - e_1) \}, \]
    %
    so $B$ is an arithmetic progression.
\end{proof}

We now generalize the last two theorems to arbitrary groups.

\begin{theorem}[Kneser's Theorem]
    For any additive sets $A$ and $B$, if $H = \text{Sym}(A + B)$, then
    %
    \begin{align*}
        \#(A + B) &\geq \#(A + H) + \#(B + H) - \#(H).
    \end{align*}
    %
    Often, it is simpler to use the weaker bound
    %
    \[ \#(A + B) \geq \#(A) + \#(B) - \#(H). \]
\end{theorem}
\begin{proof}
    Assume $\#(A) \geq \#(B)$. We perform a \emph{triple} induction, first on $\#(A + B)$, then $\#(A) + \#(B)$, then $\#(B)$. We induct upwards on $\#(A + B)$, downwards on $\#(A) + \#(B)$, and upwards on $\#(B)$. The downward induction is not contradictory because we have the bound $\#(A) + \#(B) \leq 2 \#(A + B)$. The base cases where $\#(A + B) = 1$, or $\#(A) + \#(B) = 2 \cdot \#(A + B)$, or where $\#(B) = 1$ are obvious and so it suffices to prove the inductive step.

    If $H$ is nontrivial, we let $\pi: G \to G/H$ be the standard projection. Then
    %
    \[ \#(A + B) = \#(H) \#(\pi(A + B)) = \#(H) \#(\pi(A) + \pi(B)). \]
    %
    Since $\#(H) > 1$, $\#(\pi(A) + \pi(B)) < \#(A + B)$, and $\text{Sym}(\pi(A + B)) = \{ e \}$, so we can apply induction to conclude that
    %
    \[ \#(\pi(A) + \pi(B)) \geq \#(\pi(A)) + \#(\pi(B)) - 1. \]
    %
    But this implies that
    %
    \begin{align*}
        \#(A + B) &= \#(H) \cdot \#(\pi(A) + \pi(B))\\
        &\geq \#(H) \cdot \#(\pi(A)) + \#(H) \cdot \#(\pi(B)) - 1 \\
        &\geq \#(A + H) + \#(B + H) - 1.
    \end{align*}
    %
    Thus we may assume in the rest of the argument, without loss of generality, that $\text{Sym}(A + B) = \{ e \}$.

    Suppose $B_e = B$ for all $e \in A - B$. Then, as we saw in the Cauchy-Davenport theorem, we have $(A + B) - B \subset A$ and so $B$ is contained in a coset of some finite subgroup $K$ of $G$, and $A$ is a union of cosets in $G/K$. But this means $K \subset \text{Sym}(A + B) = \{ e \}$, which implies that $K$ is trivial, and so $B$ is a singleton, in which case the theorem is trivial.

    Thus we are reduced to the case where there exists some $e \in A - B$ such that $\#(B_e) < \#(B)$. Pick $e$ which \emph{maximizes} $\#(B_e)$ subject to the constraint that $\#(B_e) < \#(B)$. Without loss of generality, translating $B$ if necessary, we may assume that $e = 0$. Thus $A_e = A \cup B$ and $B_e = A \cap B$.

    Now we know that $\#(A \cup B) + \#(A \cap B) = \#(A) + \#(B)$ and that $\#(A \cap B) < \#(B)$. Thus we may apply induction to conclude that if $X = (A \cup B) + (A \cap B)$, then
    %
    \[ \#(X) \geq \#((A \cup B) + K) + \#((A \cap B) + K) - \#(K), \]
    %
    where $K = \text{Sym}(X)$.

    Let $C = (A \cap B) + K$. Then
    %
    \begin{align*}
        (A \cup C) + (B \cup C) &= A + B
    \end{align*}
    %
    Thus we can replace $A$ and $B$ with $A \cup C$ and $B \cup C$ without modifying $A + B$. If $C$ is not contained in $A \cap B$, then $\#(A \cup C) + \#(B \cup C) > \#(A) + \#(B)$, and so we can apply induction to conclude that
    %
    \begin{align*}
        \#(A + B) &\geq \#((A \cup C) + H) + \#((B \cup C) + H) - \#(H)\\
        &\geq \#(A + H) + \#(B + H) - \#(H).
    \end{align*}
    %
    Thus, without loss of generality, we may assume that $C = A \cap B$. But this means that $K \subset \text{Sym}(A \cap B)$, and so $C = A \cap B$ is a union of cosets of $G/K$.

    We know that $X$ is a subset of $A + B$. If $X = A + B$, then $K = \text{Sym}(A + B) = \{ e \}$, and so by the inductive hypothesis,
    %
    \[ \#(A + B) = \#(X) \geq \#(A \cup B) + \#(A \cap B) - 1 = \#(A) + \#(B) - 1. \]
    %
    Thus we may assume that $X$ is a proper subset of $A + B$.

    Let $A'$ be the set of $a \in A$ such that $a + B$ is not a subset of $X$. Then $A'$ is nonempty since $X$ is a proper subset of $A + B$. If we pick $b \in B$ such that $a + b \not \in X$, then $a + b + K$ is disjoint from $X$. This means that $((a + K) \cap A) + b$ is disjoint from $X$, but contained in $A + B$. Thus
    %
    \[ \#(A + B) \geq \#(((a + K) \cap A) + b) + \#(X). \]
    %
    Since $b \in A \cup B$, and $X = (A \cap B) + (A \cup B)$, the fact that $a + (b + K)$ is disjoint from $X$ implies that $a + K$ is disjoint from $A \cap B$. This means that
    %
    \begin{align*}
        \#((A \cup B) + K) &\geq \#(A \cup B) + \#((a + K) \ssm (A \cup B))\\
        &= \#(A \cup B) + \#(K) - \#((a + K) \cap A) - \#((a + K) \cap B)
    \end{align*}
    %
    Putting these two inequalities together with the inductive hypothesis on $\#(X)$, we find that
    %
    \begin{align*}
        \#(A + B) &\geq \#(((a + K) \cap A) + b) + \#(X)\\
        &\geq \#(((a + K) \cap A) + b) + \#((A \cup B) + K) + \#((A \cap B) + K) - \#(K)\\
        &= \#(((a + K) \cap A)) + \#((A \cup B) + K) + \#(A \cap B) - \#(K)\\
        &\geq \#(A \cup B) + \#(A \cap B) - \#((a + K) \cap B)\\
        &= \#(A) + \#(B) - \#((a + K) \cap B).
    \end{align*}
    %
    Our proof would be complete if there exists $a \in A'$ such that $\#((a + K) \cap B) \leq 1$. Thus we may assume that $\#((a + K) \cap B) > 1$ for all $a \in A'$. In the next paragraph we show this situation is impossible given our prior assumptions.

    For each $a \in A'$, let $A_a = (a + K) \cap A$ and let $B_a = (a + K) \cap B$. Note that for each such $a$, $A_a - B_a \subset K$. Suppose we can find $a_1,a_2 \in A'$ such that $A_{a_1} - B_{a_1} + B_{a_2}$ is not a subset of $A_{a_2}$. Then we can find $e \in A_{a_1} - B_{a_1}$ such that $e + B_{a_2}$ is not a subset of $A_{a_2}$. This means that $B$ is not contained in $A - e$, and so $B_e$ is strictly smaller than $B$. Since $e \in K$, we find that $B \cap (A - e)$ contains
    %
    \[ B \cap ((A \cap B) - e) = B \cap (A \cap B) = A \cap B. \]
    %
    But this contradicts the maximality of the $e$-transform we chose at the beginning of the argument, i.e. which gave $B_0 = A \cap B$. Thus we must always have $A_{a_1} - B_{a_1} + B_{a_2} \subset A_{a_2}$ for all $a,a' \in A'$. Symmetry thus implies that $\#(A_{a_1}) = \#(A_{a_2})$ for all $a_1,a_2 \in A'$, and this means that there exists a finite subgroup $L_{a_1a_2}$ of $G$ such that $A_{a_1}$ and $A_{a_2}$ are a finite union of cosets of $G/L_{a_1a_2}$, and that $B_{a_1}$ and $B_{a_2}$, being subsets of $B_{a_1} - B_{a_2}$ and $B_{a_2} - B_{a_1}$ respectively, are contained in a single coset of $G/L_{a_1a_2}$. Taking $L = \bigcap L_{a_1a_2}$ shows that $B_a$ is contained in a single coset of $G/L$ for each $a$ and that each $A_a$ is a union of cosets of $G/L$ for each $a$. Since $\#(B_a) > 1$ for all $a \in A'$, this means that $\#(L) \geq 2$. Now
    %
    \[ A + B = X \cup \bigcup_{a \in A'} (A_a + B) \]
    %
    Since $A_a = (a + K) \cap A$ is contained in a coset of $K$, this means a coset of $G/L$ is contained in a coset of $G/K$, and thus $L \subset K$. Thus $X$, which is a union of cosets in $G/K$, is a union of coset in $G/L$. On the other hand, $A_a + B$ is also a union of cosets in $G/L$, since $A_a$ is. But this means $A + B$ is a union of cosets in $G/L$, hence $L \subset \text{Sym}(A + B)$, contradicting the fact that $\text{Sym}(A + B)$ is trivial.
\end{proof}

Recall that basic estimates show that $\sigma(A) = \delta(A) = 1$ if and only if $A$ is a coset of a finite group. In this corollary to Kneser's theorem, we show that if $\sigma(A)$ or $\delta(A)$ is small, then $A$ is a large subset of a coset of a finite group.

\begin{corollary}
    The following are equivalent:
    %
    \begin{enumerate}
        \item $\sigma(A) < 3/2$.
        \item $\delta(A) < 3/2$.
        \item $\#(A + B) < (3/2) \#(A)$ for some additive set $B$ with $\#(A) \leq \#(B)$.
        \item $\#(nA - mA) < (3/2) \#(A)$ for all $n$ and $m$.
        \item $A$ is a subset of a coset of $G/H$ for some subgroup $H$ with $\#(H) < (3/2) \#(A)$.
    \end{enumerate}
\end{corollary}
\begin{proof}
    It is obvious that (1),(2), and (4) individually imply (3). If we assume (5), then $A + A$ is contained in a single coset of $H$, and so
    %
    \[ \sigma(A) = \frac{\#(A + A)}{\#(A)} \leq \frac{\#(H)}{\#(A)} < (3/2). \]
    %
    Thus (1) holds. Thus it remains to show that (3) implies (5).

    Suppose (3) is true. Applying Kneser's theorem, setting $H = \text{Sym}(A+B)$, we conclude that
    %
    \[ (3/2) \#(A) > \#(A) + \#(B) - \#(H) \geq 2 \#(A) - \#(H). \]
    %
    Rearranging, we find that $\#(H) > \#(A) / 2$. But since $\#(H)$ divides $\#(A + B) < 3 \#(H)$, this implies that either $\#(A + B) = 2\#(H)$ or $\#(A + B) = \#(H)$. Suppose first that $A + B$ is a union of two cosets in $H$. Then $\#(H) = (1/2) \#(A + B) < (3/4) \#(A) \leq (3/4) \#(B)$, which implies that neither $A$ nor $B$ is contained in a single coset of $H$. Thus Kneser's theorem implies that
    %
    \[ 2 \#(H) = \#(A + B) \geq \#(A + H) + \#(B + H) - \#(H) \geq 3\#(H), \]
    %
    which gives a clear contradiction. On the other hand, if $\#(A + B) = \#(H)$, then $A + B$ is a single coset of $G/H$, so $A$ is contained in a single coset of $G/H$, which proves that (5) holds.
\end{proof}

In the next result, we show that if $\#(A + B)$ is suitably small, then Kneser's theorem is actually an equality. 

\begin{corollary}
    If $\#(A + B) \leq \#(A) + \#(B) - 1$, and $H = \text{Sym}(A + B)$, then
    %
    \[ \#(A + B) = \#(A + H) + \#(B + H) - \#(H). \]
\end{corollary}
\begin{proof}
    By Kneser's theorem, it suffices to prove
    %
    \[ \#(A + B) \leq \#(A + H) + \#(B + H) - \#(H). \]
    %
    Now $\#(H)$ divides $\#(A + B)$, $\#(A + H)$, and $\#(B+H)$. We have the trivial inequality
    %
    \[ \#(A + B) \leq \#(A) + \#(B) - 1 \leq \#(A + H) + \#(B + H) - 1. \]
    %
    But since everything here is divisible by $\#(H)$, this inequality immediately improves to give the result that
    %
    \[ \#(A + B) \leq \#(A + H) + \#(B + H) - \#(H). \qedhere \]
\end{proof}

\begin{theorem}
    Let $A$ and $B$ be additive sets. Then
    %
    \[ \#(A + B) \geq \#(A) + \#(B) - \min_{c \in A + B} \# \{ (a,b) \in A \times B: a + b = c \}. \]
\end{theorem}
\begin{proof}
    It suffices to prove that for each $c \in A + B$,
    %
    \[ \# \{ (a,b) \in A \times B: a + b = c \} \geq \#(A) + \#(B) - \#(A + B). \]
    %
    If $\#(A + B) \geq \#(A) + \#(B)$, this inequality is trivial. Thus we may assume $\#(A + B) \leq \#(A) + \#(B) - 1$, in which case it follows that
    %
    \[ \#(A + B) = \#(A + H) + \#(B + H) - \#(H), \]
    %
    where $H = \text{Sym}(A + B)$. We therefore have to prove that
    %
    \[ \# \{ (a,b) \in A \times B: a + b = c \} \geq \#(H) - \#((A + H) \ssm A) - \#((B + H) \ssm B). \]
    %
    Fix $(a_0,b_0) \in A \times B$ with $a_0 + b_0 = c$. Then for each $h \in H$,
    %
    \[ (a_0 + h) + (b_0 - h) = c. \]
    %
    If $(a_0 + h, b_0 - h) \not \in A \times B$, either $a_0 + h \in (A + H) \ssm A$ or $b_0 - h \in (B + H) \ssm B$. Thus
    %
    \begin{align*}
        \# \{ (a,b) &\in A \times B: a + b = c \}\\
        &\geq \# \{ h \in H : (a_0+h,b_0-h) \in A \times B \} \\
        &\geq \#(H) - \# \{ h \in H : a_0 + h \in \#((A + H) \ssm A) \}\\
        &\quad\quad\quad\quad\quad - \# \{ h \in H : b_0 - h \in \#((B + H) \ssm B) \}\\
        &\geq \#(H) - \#((A + H) \ssm A) - \#((B + H) \ssm B). \qedhere
    \end{align*}
\end{proof}

Here is an interesting analytic consequence of Kneser's theorem.

\begin{theorem}
    For any two open sets $A,B \subset \TT^d$,
    %
    \[ |A + B| \geq \min(1, |A| + |B|), \]
    %
    where $| \cdot |$ is the unit Haar measure on $\TT^d$.
\end{theorem}
\begin{proof}
    We note that for each prime $p$, $\TT^d$ has a subgroup $G_p$ isomorphic to $\ZZ_p^d$. For any open set $U \subset \TT^d$, let $U_p = U \cap G_p$. Then
    %
    \[ |U| = \lim_{p \to \infty} \#(U_p) / p^d. \]
    %
    Applying Kneser's theorem, we conclude that
    %
    \begin{align*}
        |A + B| &= \lim_{p \to \infty} \#((A + B)_p) / p^d\\
        &\geq \lim_{p \to \infty} \#(A_p + B_p)/ p^d\\
        &\geq \lim_{p \to \infty} \#(A_p)/p^d + \#(B_p)/p^d - \#(\text{Sym}(A_p + B_p))/p^d\\
        &\geq |A| + |B| - \liminf_{p \to \infty} \#(\text{Sym}(A_p + B_p)) / p^d.
    \end{align*}
    %
    Write $\#(\text{Sym}(A_p + B_p)) = p^{k_p}$ for some $k_p \in [0,d]$. We have $|A + B| \geq |A| + |B|$ unless $\#(\text{Sym}(A_p + B_p)) = p^d$ for all sufficiently large $p$. But this implies that $A_p + B_p = G_p$, which means $A + B$ contains $G_p$ for all sufficiently large $p$. Since $A + B$ is open, and $\bigcup_{p \geq p_0} G_p$ is dense for all choices of $p_0$, $A + B$ is a dense, open set, and so $|A + B| = 1$.
\end{proof}

\begin{remark}
    For $A,B \subset \RR^d$, the Brunn Minkowski inequality implies that $|A + B| \geq (|A|^{1/d} + |B|^{1/d})^d$. This bound is not true in $\TT^d$. The bound
    %
    \[ |A + B| \geq \min(1, (|A|^{1/d} + |B|^{1/d})^d) \]
    %
    is also not true for $d \geq 2$, since we can set $A = \TT^{d-1} \times [0,\varepsilon]$ for some $\varepsilon < 1/4$, in which case $A + A = \TT^{d-1} \times [0,2\varepsilon]$, and so $|A + A| = 2\varepsilon$, whereas $(|A|^{1/d} + |B|^{1/d})^d = 2^d \varepsilon$.
\end{remark}

If $A$ and $B$ are additive subsets of $[1,N]$, with $\#(A) + \#(B) \geq \alpha N$, then Kneser's theorem implies that $\#(A + B) \geq \alpha N$. However, it may not be true that $\#((A + B) \cap [1,N]) \geq \alpha N$. Mann's theorem shows that this is true if we assume that the numbers in $A$ and $B$ are not heavily weighted to the end of the interval, and also contain the origin.

\begin{theorem}[Mann's Theorem]
    Let $N \geq 1$, let $0 < \alpha < 1$, and let $A$ and $B$ be additive subsets of $\ZZ$, with $0 \in A \cap B$, and for all $1 \leq n \leq N$,
    %
    \[ \#(A \cap [1,n]) + \#(B \cap [1,n]) \geq \alpha n. \]
    %
    Then $\#((A + B) \cap [1,n]) \geq \alpha n$ for all $1 \leq n \leq N$.
\end{theorem}
\begin{proof}
    We prove by induction, first on $N$ and secondly on $\#(B)$. The case where $N = 1$ is trivial. Similarily, if $\#(B) = 1$, then $B = \{ 0 \}$, and then the theorem is trivial. By the inductive hypothesis, for $1 \leq n < N$,
    %
    \[ \#((A + B) \cap [1,n]) \geq \alpha n, \]
    %
    and it suffices to show that $\#((A + B) \cap [1,N]) \geq \alpha N$. Without loss of generality we may assume that $A,B \subset [0,N]$ since adding other elements to $A$ and $B$ only helps us. We will find $e \in A$, which is a subset of $A - B$ since $0 \in B$, such that $\#(B_e) < \#(B)$ and such that for all $1 \leq n \leq N$,
    %
    \[ \#(A_e \cap [1,n]) + \#(B_e \cap [1,n]) \geq \alpha n. \]
    %
    The fact that $e \in A$ implies immediately that $0 \in A_e \cap B_e$. We may thus apply the inductive hypothesis together with the fact that $A_e + B_e \subset A + B$, which proves the theorem.

    If $B$ is not a subset of $A$, then we could pick $e = 0$, since then $\#(B_e) < \#(B)$ and by the basic results of the $e$-transform, for any $1 \leq n \leq N$,
    %
    \[ \#(A_e \cap [1,n]) + \#(B_e \cap [1,n]) = \#(A \cap [1,n]) + \#(B \cap [1,n]) \geq \alpha n. \]
    %
    Thus we may assume $B \subset A$. Let $e$ be the minimum element of $A$ such that $e + B$ is not a subset of $A$. The largest element of $A$ certainly belongs to this set (since $B$ contains a positive integer) so $e$ is well defined. By construction, $(A \cap [0,e-1]) + B$ is contained in $A$, and $\#(B_e) < \#(B)$. We calculate using basic properties of the $e$-transform that for $1 \leq n \leq N$,
    %
    \begin{align*}
        \#(A_e \cap [1,n]) + \#(B_e \cap [1,n]) &= \#(A \cap [1,n]) + \#(B \cap [1,n])\\
        &\quad + \#(((B + e) \ssm A) \cap [1,e])\\
        &\quad - \#(((B + e) \ssm A) \cap (n,n+e])\\
        &= \#(A \cap [1,n]) + \#(B \cap [1,n])\\
        &\quad - \#((B \ssm (A - e)) \cap (n-e,n])\\
        &\geq \#(A \cap [1,n]) + \#(B \cap [1,n-e]).
    \end{align*}
    %
    If $B \cap (n-e,n] = \emptyset$, then it is simple to conclude by the assumptions of the theorem that $\#(A_e \cap [1,n]) + \#(B_e \cap [1,n]) \geq \alpha n$. Thus we may assume that $B \cap (n-e,n]$ is nonempty. If $b$ is the minimal element of $B \cap (n-e,n]$. Then $n - b \leq e - 1 < N$. Since $A \cap [1,n] = (A_e \cap [1,b-1]) \cup \{ b \} \cup (A_e \cap [b+1,n])$,
    %
    \begin{align*}
        \#(A_e \cap [1,n]) + \#(B_e \cap [1,n]) &\geq \#(A \cap [1,n]) + \#(B \cap [1,n-e])\\
        &= \#(A \cap [1,b-1]) + \#(A \cap [b+1,n]) + 1\\
        &\quad + \#(B \cap [1,b-1]).
    \end{align*}
    %
    By assumption, $\#(A \cap [1,b-1]) + \#(B \cap [1,b-1]) \geq \alpha (b-1)$. Since $A$ contains $A \cap [0,e-1] + B$, we conclude that
    %
    \begin{align*}
        \#(A \cap [b+1,n]) &\geq \#(((A \cap [0,e-1]) + B) \cap [b+1,n])\\
        &\geq \#(((A \cap [0,e-1]) + b) \cap [b+1,n])\\
        &= \#(A \cap [0,e-1] \cap [1,n-b])\\
        &= \#(A \cap [1,n-b])\\
        &= \#((A + B) \cap [1,n-b])\\
        &\geq \alpha(n-b).
    \end{align*}
    %
    Putting these inequalities together gives
    %
    \[ \#(A_e \cap [1,n]) + \#(B_e \cap [1,n]) \geq \alpha(b-1) + 1 + \alpha(n-b) \geq \alpha n. \qedhere \]
\end{proof}

Finally, we develop an inverse theorem characterizing the behaviour of additive sets $A$ in $\ZZ$ with $\sigma(A) < 3 - 3/\#(A)$.

\begin{lemma}
    Let $A$ be an additive set in $\ZZ$, with $0 \in A$. Let $N \geq 1$ be an integer, let $\phi_N: \ZZ \to \ZZ_N$ be the standard projection map, and for each $x \in \phi_N(A)$, let $\mu(x) = \#\{ a \in A: \phi_N(a) = x \}$. Let $m = \min_{x \in \phi_N(A) - \{ 0 \}} \mu_x$. Then
    %
    \[ \#(2A) \geq \#(A) + (2m - 1) \cdot \#(\phi_N(2A)) - (2m - \mu_0) \cdot \#(\phi_N(A)). \]
\end{lemma}
\begin{proof}
    We calculate that
    %
    \begin{align*}
        \#(2A) &= \sum_{x \in \phi_N(2A)} \#(2A \cap \phi_N^{-1}(x))\\
        &\geq \sum_{x \in \phi_N(2A)} \sup_{\substack{y,z \in \phi_N(A)\\ y + z = x}} \{ \#((A \cap \phi_N^{-1}(y)) + (A \cap \phi_N^{-1}(z))) \}\\
        &\geq \sum_{x \in \phi_N(2A)} \sup_{\substack{y,z \in \phi_N(A)\\ y + z = x}} \left( \#(A \cap \phi_N^{-1}(y) + \#(A \cap \phi_N^{-1}(z)) - 1 \right)\\
        &= \left( \sum_{x \in \phi_N(2A)} \sup_{\substack{y,z \in \phi_N(A)\\ y + z = x}} \mu(y) + \mu(z) \right) - \#(\phi_N(2A))\\
        &\geq \sum_{x \in \phi_N(A)} (\mu_0 + \mu_x) + \sum_{x \in \phi_N(2A) \ssm \phi_N(A)} (2m) - \#(\phi_N(2A))\\
        &= \mu_0 \cdot \#(\phi_N(A)) + \#(A) + 2m \cdot \#(\phi_N(2A) \ssm \phi_N(A)) - \#(\phi_N(2A))\\
        &= \#(A) + (2m - 1) \cdot \#(\phi_N(2A)) - (2m - \mu_0) \cdot \#(\phi_N(A)). \qedhere
    \end{align*}
\end{proof}

\begin{theorem}
    Let $A$ be an additive set in $\ZZ$ such that $\sigma(A) < 3 - 3/\#(A)$. Then there is an arithmetic progression of length $\#(2A) - \#(A) + 1$ containing $A$.
\end{theorem}
\begin{proof}
    Without loss of generality, assume $\min(A) = \{ 0 \}$. Assume also that the elements of $A$ have no common divisor, and that $\#(A) \geq 3$. Let $N = \max(A)$. It will suffices to show that $N \leq \#(2A) - \#(A)$. Suppose instead that $\#(N) > \#(2A) - \#(A)$. We now apply the last lemma, with $\mu_0 = 2$ and $m = 1$. Thus
    %
    \[ \#(2A) \geq \#(A) + \#(\phi_N(2A)). \]
    %
    The hypothesis that $\#(2A) < 3\#(A) - 3$ implies that
    %
    \[ \#(\phi_N(2A)) < 2\#(A) - 3 = 2\#(\phi_N(A)) - 1. \]
    %
    If $N$ were prime we could apply the Cauchy-Davenport theorem. Instead, we use Kneser's theorem, so that
    %
    \[ 2\#(\phi_N(A)) - 1 > \#(\phi_N(2A)) \geq 2\#(\phi_N(A) + H) - \#(H), \]
    %
    where $H = \text{Sym}(\phi_N(2A))$. If $M = \#(\phi_N(A) + H) - \#(\phi_N(A))$, then
    %
    \[ 0 \leq M < \frac{\#(H) - 1}{2}. \]
    %
    Since $M$ is an integer, this improves to give a bound
    %
    \[ 0 \leq M \leq \frac{\#(H) - 2}{2}. \]
    %
    Thus $2 \leq \#(H) < N$, since $\phi_N(2A) \neq \ZZ_N$. We can write $H = L \ZZ + N \ZZ$ for some $2 \leq L \leq N/2$ that divides $N$. Since the elements of $A$ have no common divisor, $\#(\phi_L(A)) \geq 2$. We apply the last lemma with $\phi_N$ replaced by $\phi_L$.
\end{proof}

\section{Freiman Homomorphisms}

If $A$ and $B$ are additive sets in two groups $G$ and $H$, a \emph{Freiman homomorphism} of rank $k$ is a map $f: A \to B$ such that for any $a_1,\dots,a_k,a_1',\dots,a_k' \in A$, if $a_1 + \dots + a_k = a_1' + \dots + a_k'$, then $\phi(a_1) + \dots + \phi(a_k) = \phi(a_1') + \dots + \phi(a_k')$. If $\phi$ is a Freiman homomorphism of rank $k$, it is also a Freiman homomorphism of rank $k'$ for any $k' \leq k$. Many problems in additive combinatorics are invariant under Freiman isomorphisms of a suitably large rank.

\begin{remark}
    One could have defined a `rank $k$' additive set $A$ intrinsically by considering an equivalence relation on $A^k$, i.e. where we imagine that $(a_1,\dots,a_k) \sim (a_1',\dots,a_k')$ if $a_1 + \dots + a_k = a_1' + \dots + a_k'$. One can develop the theory of additive sets intrinsically, but there does not seem to be much advantage in working intrinsically vs extrinsically.
\end{remark}

Obviously, all homomorphisms of groups are Freiman homomorphisms of arbitrarily large rank. Similarily, `affine maps', i.e. homomorphisms composed by translations, are also Freiman homomorphisms. Let us consider some less trivial examples which cannot be induced by homomorphisms of ambient groups.

\begin{example}
    The quotient map $\phi: \ZZ \to \ZZ_n$, which is a Freiman homomorphism of any order. On the other hand, it is not a Freiman isomorphism, though it restricts to a rank $k$ isomorphism from $[1,m]$ onto its image if $n > k(m-1)$.
\end{example}

\begin{example}
    Fix $a,r \in G$, and let $P = \{ a, a+r, \dots, a + (n-1)r \}$ be the corresponding length $n$ arithmetic progression in $G$. We have a natural Freiman homomorphism $\phi: [0,n) \to P$ which has arbitrarily large rank, because if $m_1 + \dots + m_k = m_1' + \dots + m_k'$, then
    %
    \begin{align*}
        \phi(m_1) + \dots + \phi(m_k) &= ka + (m_1 + \dots + m_k) r\\
        &= ka + (m_1' + \dots + m_k') r\\
        &= \phi(m_1') + \dots + \phi(m_k').
    \end{align*}
    %
    On the other hand, this is a Freiman isomorphism of rank $k$ if and only if $\text{ord}(r) > k(n-1)$.
\end{example}

\begin{example}
    The sets $\{ 0,1,10,11 \}$ and $\{ 0,1,100,101 \}$ are Freiman isomorphic of order $k$ for any $k < 10$, but not for any $k \geq 10$.
\end{example}

\begin{lemma}
    Let $f:A \to B$ be a Freiman homomorphism of rank $k$. Then if $|\varepsilon_1| + \dots + |\varepsilon_n| \leq k$, and $A_1,\dots,A_n \subset A$, then
    %
    \[ \#(\varepsilon_1 \phi(A_1) + \dots + \varepsilon_n \phi(A_n)) \leq \#(\varepsilon_1 A_1 + \dots + \varepsilon_n A_n). \]
    %
    This inequality becomes an equality if $f$ is an isomorphism.
\end{lemma}
\begin{proof}
    Without loss of generality assume that $\varepsilon_i \in \{ \pm 1 \}$ for each $i$, and that $n = k$. Consider the two maps
    %
    \[ \psi_1: A_1 \times \dots \times A_k \to B \]
    %
    and
    %
    \[ \psi_2: A_1 \times \dots \times A_k \to A \]
    %
    where
    %
    \[ \psi_1(a_1,\dots,a_k) = \varepsilon_1 \phi(a_1) + \dots + \varepsilon_k \phi(a_k), \]
    %
    and
    %
    \[ \psi_2(a_1,\dots,a_k) = \varepsilon_1 a_1 + \dots + \varepsilon_k a_k. \]
    %
    Then $\psi_1(A_1 \times \dots \times A_k) = \varepsilon_1 \phi(A_1) + \dots + \varepsilon_n \phi(A_n)$ and $\psi_2(A_1 \times \dots \times A_k) = \varepsilon_1 A_1 + \dots + \varepsilon_n A_n$. If $\psi_2(a_1,\dots,a_k) = \psi_2(a_1',\dots,a_k')$, then
    %
    \[ \sum_{\varepsilon_i = 1} a_i + \sum_{\varepsilon_i = -1} a_i' = \sum_{\varepsilon_i = 1} a_i' + \sum_{\varepsilon_i = -1} a_i \]
    %
    and so
    %
    \[ \sum_{\varepsilon_i = 1} \phi(a_i) + \sum_{\varepsilon_i = -1} \phi(a_i') = \sum_{\varepsilon_i = 1} \phi(a_i') + \sum_{\varepsilon_i = -1} \phi(a_i) \]
    %
    which implies $\psi_1(a_1,\dots,a_k) = \psi_2(a_1',\dots,a_k')$. Thus the theorem follows.
\end{proof}

If one wants to understand the sum sets of a \emph{fixed} family of sets $A_1,\dots,A_n$, one needs less structure than a Freiman homomorphism from $A_1 \cup \dots \cup A_n$ to $B$. Indeed, individual translations of each set preserve all sum sets of the form $\#(k_1 A_1 + \dots + k_n A_n)$ and so we would hope these are included in the family of transformations we consider. One trick to doing this is to consider the disjoint union
%
\[ A = A_1 \times \{ e_1 \} \cup \dots \cup A_n \times \{ e_n \} \]
%
in $G \times \ZZ^n$. If $\phi: A \to B$ is a rank $k$ Freiman homomorphism, if $|k_1| + \dots + |k_n| = k$, and if we define $\phi_i(a) = \phi(a,e_i)$ for $i \in [1,n]$, then
%
\[ \#(k_1 \phi_1(A_1) + \dots + k_n \phi_n(A_n)) \leq \#(k_1 A_1 + \dots + k_n A_n). \]
%
We note that the map $\phi: A \to G$ given by setting $\phi(a,e_i) = (a + s_i, e_i)$ is a Freiman isomorphism of arbitrary order.

\begin{theorem}
    Suppose $\phi: A \to B$ is a Freiman homomorphism of order $k \geq 2$. If $P$ is a rank $k$ arithmetic progression in $A$ TODO
\end{theorem}

An interesting corollary to these definitions is that for any additive set $A$ in a torsion free group, and any $k > 0$, there is an order $k$ Freiman isomorphism from $A$ to a subset of $\ZZ$, or even to a subset of $\ZZ_n$ for some large $n$. We also have a `compression lemma' in this setting.

\begin{theorem}
    Let $A$ be an additive set in a group $G$ which is torsion, or cyclic of prime order. Fix integers $n,m \geq 1$ such that
    %
    \[ 2n \#(nA - nA) < m < \#(Z). \]
    %
    Then there is $A' \subset A$ with $\#(A') \geq (1/n) \#(A)$ and an order $n$ Freiman isomorphism from $A'$ to a subset of $\ZZ_m$.
\end{theorem}
\begin{proof}
    Without loss of generality, in light of the preceding paragraph, we may assume $A$ is a subset of $\ZZ_p$ for some prime $p$. Consider the three maps $\pi_p: \ZZ \to \ZZ_p$, $\pi_m: \ZZ \to \ZZ_m$, and $i: \ZZ_p \to \{ 0, \dots, p-1 \}$, defined in the obvious manner, and set $\pi = \pi_m \circ i$. The function $\pi$ is not a homomorphism of groups, but it is a Freiman homomorphism of order $n$ when restricted to any set of the form $\pi_p(X)$, where $X$ are a set of fewer than $p/n$ contiguous elements of $\ZZ$; if $a_1,\dots,a_n$ and $a_1',\dots,a_n'$ are elements of $X$, then
    %
    \[ -p < (a_1 + \dots + a_n) - (a_1' + \dots + a_n') < p. \]
    %
    Thus if $\pi_p(a_1) + \dots + \pi_p(a_n) = \pi_p(a_1') + \dots + \pi_p(a_n')$, then $a_1 + \dots + a_n = a_1' + \dots + a_n'$, and so $\pi_m(a_1) + \dots + \pi_m(a_n) = \pi_m(a_1') + \dots + \pi_m(a_n')$.

    Consider the disjoint family of sets
    %
    \[ \{ Z_k = \pi_p((k(p/n),(k+1)p/n]) : 0 \leq k \leq n-1 \}. \]
    %
    whose union is $\ZZ_p$. Applying the pidgeonhole principle, for each $\lambda$, there exists $k_\lambda$ such that $\#(Z_{k_\lambda} \cap (\lambda \cdot A)) \geq \#(A) / n$. If we set $A_\lambda = Z_{k_\lambda} \cap (\lambda \cdot A)$, then $\pi: A_\lambda \to \ZZ_n$ is an injective Freiman homomorphism of rank $n$. All that remains is to show that for some choice of $\lambda \in \ZZ_p^\times$, $\pi$ is a Freiman isomorphism of rank $n$ when restricted to the domain $A_\lambda$.

    It suffices to show that there is some $\lambda \in \ZZ_p^\times$ such that for any family of elements $a_1,\dots,a_n$ and $a_1',\dots,a_n'$ in $i(A_\lambda)$ with
    %
    \[ \pi_m(a_1) + \dots + \pi_m(a_n) = \pi_m(a_1') + \dots + \pi_m(a_n'), \]
    %
    then $a_1 + \dots + a_n = a_1' + \dots + a_n'$. We call such an occurence a \emph{collision}. This can only happen if $n i(A_\lambda) - n i(A_\lambda)$ contains a nonzero multiple of $m$. Since $-n(p-1) \leq n i(A_\lambda) - n i(A_\lambda) \leq n(p-1)$, if $n i(A_\lambda) - n i(A_\lambda)$ contains $km$, then $|k| \leq n(p-1)/m$. Now for each such integer $k$,
    %
    \begin{align*}
        \PP \left( km \in n i(\lambda \cdot A) - n i(\lambda \cdot A) \right) &= \PP \left( km + p \ZZ \in \lambda \cdot (nA - nA) \right)\\
        &= \sum_{x \in nA - nA} \PP(\lambda x = km + p \ZZ)\\
        &= \sum_{x \in nA - nA} \PP(\lambda^{-1} = x / (km + p \ZZ))\\
        &= \sum_{x \in (nA - nA) \ssm \{ 0 \}} \frac{1}{p-1}\\
        &\leq \frac{\#(nA - nA)}{p - 1}.
    \end{align*}
    %
    A union bound thus implies that a collision happens with probability at most $(2n/m) \#(nA - nA)$. Since $m > 2n \#(nA - nA)$ this probability is less than one, so there is some $\lambda \in \ZZ_p^\times$ for which no collision occurs.
\end{proof}

\chapter{Miscellania}

\section{Sum Free Sets}

Given a subset $A$ of an abelian group, we say $A$ is {\bf sum free} if $A + A$ is disjoint from $A$.

\begin{theorem}
    If $A$ is an arbitrary finite subset of positive natural numbers, then $A$ contains a sum-free subset of size greater than $|A|/3$.
\end{theorem}
\begin{proof}
    The idea of this proof rests on two observations. If $B \subset [1,N]$, and $p > 2N$, then $B + p \mathbf{Z}$ is sumfree in $\mathbf{Z}_p$ if and only if $B$ is sumfree. Thus we can turn out problem into a problem modulo $p$. Next, we notice that if $f$ is an automorphism, then a subset $B$ of an abelian group is sumfree if and only if $f(B)$ is sumfree. The presense of many automorphisms of $\mathbf{Z}_p$ (one for each natural number between $1$ and $p-1$) enables us to exploit randomness to construct a sumfree subset in $A$. If $X \subset \mathbf{Z}_p$ is sumfree, and does {\it not} contain zero, we consider the sets $X,2X, \dots, (p-1)X$, which are all sumfree. For every $a \in X$, and nonzero $b \in \mathbf{Z}_p$, there is a unique $c \in [1,p)$ such that $ca = b$. Thus every nonzero $b \in \mathbf{Z}_p$ occurs in $|X|/(p-1)$ of the sets $X,\dots, (p-1)X$. Thus means if we choose a nonzero $x \in \mathbf{Z}_p$ uniformly at random, then
    %
    \[ \mathbf{E} |(A + \mathbf{Z}_p) \cap xX| = \sum_{a \in A + \mathbf{Z}_p} \mathbf{P}(a \in xX) = \frac{|A| |X|}{p-1} \]
    %
    Since $xX$ is sumfree, so too is $(A + \mathbf{Z}_p) \cap xX$, and so lower bounding the expectation gives rise to a large sumfree sert. In $\mathbf{Z}_p$, a good candidate for a sumfree set should be an interval, since an arithmetic progression has a small sumset, and all arithmetic progressions are mapped to an interval by an automorphism. Thus, taking $X = [k,2k)$, where $4k - 2 < p + k$, we get a squarefree set. Thus taking $p$ congruent to two modulo 3, and setting $3k = p + 1$, we find a sumfree set of size
    %
    \[ \frac{k}{p-1} |A| = \frac{p + 1}{3(p-1)} |A| > |A|/3 \]
    %
    which completes the proof.
\end{proof}

A fundamental problem in additive combinatorics is the {\it inverse sumset} problem. If $A + B$ or $A - B$ is small, what can one say about $A$ and $B$? More specifically, if $A + A$ is small, what can one say about $A$? We have $|A| \leq |A + A| \leq [|A|^2 + |A|]/2$, and so we refer to the value $\sigma(A) = |A + A|/|A|$ as the {\bf doubling constant} of the set $A$. We have $1 \leq |A| \leq (|A| + 1)/2$.

\begin{example}
    Geometric progressions have the largest doubling constant possible. If
    %
    \[ A = \{ 1, a, a^2, \dots, a^{N-1} \} \]
    %
    then the sum of any two elements of $A$ is distinct, so $|A + A| = (N^2 + N)/2$, and so $\sigma(A) = (N+1)/2$.
\end{example}

A set $A$ with $\sigma(A)$ maximal among sets of size $N$ is known as a {\bf Sidon set}. This means that all pairwise sums of any two $a_0,a_1 \in A$ are distinct, modulo the trivial equalities $a_0 + a_1 = a_1 + a_0$. This is a `generic' behaviour: If $A$ is a subset of $N$ points chosen uniformly at random frmo $[0,1]$, then $A$ is Sidon with probability one. It is more interesting to characterize when $\sigma(A)$ is small.

\begin{example}
    In the other extreme, the main example of sets with small doubling constant is an arithmetic progression. If $A = b_0 + [0,N-1] a$, then $A + A = 2b_0 + [0,2N-2] a$, which consists of $2N-1$ points, so $\sigma(A) = 2 - 1/N$.
\end{example}

\begin{example}
    If $A \subset B$, and $|A| = \alpha |B|$, then $|A + A| \leq |B + B|$, so
    %
    \[ \sigma(A) \leq \frac{|B+B|}{K|B|} = \sigma(B)/\alpha \]
    %
    Thus if $\sigma(B)$ is small, and $A$ contains a large percentage of $B$, then $\sigma(A)$ is also small. In the other direction, if $|B| = \beta |A|$, then
    %
    \[ |B+B| \leq |A + A| + |A + (B - A)| + |(B-A) + (B-A)| \leq \sigma(A)|A| + (\beta - 1)|A|^2 + \beta^2 |A|^2 \]
    %
    so
    %
    \[ \sigma(B) \leq \sigma(A)/\beta + (\beta + 1 - 1/\beta)|B| \]
    %
    Thus if $\sigma(A)$ is small, and $B$ doesn't contain many more points than $A$, then $\sigma(B)$ is also small.
\end{example}

\begin{example}
    If we consider $N$ and $M$, and a resultant `rank 2' arithmetic progression $A = c + [0,N]a + [0,M]b$, then $\sigma(A) \leq 4$. These sets can look very different from the original arithmetic progressions we were considering.
\end{example}

If $A$ and $B$ are additive sets, and we form the graph $G$

\section{Graph Theoretic Techniques}

\begin{theorem}[Tur\'{a}n]
    Let $G$ be a graph of $n$ vertices. Then $G$ contains an independant set of size at least
    %
    \[ \sum_{v \in G} \frac{1}{\deg(v) + 1} \]
    %
    In particular, if the vertices have degree bounded by $d$, then there is an independant set of size $|G|(d+1)^{-1}$.
\end{theorem}
\begin{proof}
    Let $\pi: V \to [1,n]$ be a uniformly randomly chosen bijection. Let $S$ be the set of all vertices $v$ in $V$ such that for any neighbour $w$ of $v$, $\pi(v)$ is larger than $\pi(w)$. Then $S$ is an independant set, and it suffices to show $S$ is large in expectation. We find by the hockey stick identity that
    %
    \begin{align*}
        \mathbf{P}(v \in S) &= \frac{1}{n!} \sum_{m = 1}^n {m-1 \choose \deg(v)} \deg(v)! (n - 1 - \deg(v))!\\
        &= \frac{\deg(v)! (n - 1- \deg(v))!}{n!} {n \choose \deg(v)+1}\\
        &= \frac{1}{\deg(v)+1}
    \end{align*}
    %
    and so
    %
    \[ \mathbf{E}|S| = \sum_{v \in G} \mathbf{P}(v \in S) = \sum_{v \in G} \frac{1}{\deg(v) + 1} \]
    %
    and this gives the required set.
\end{proof}

Given $B \subset A$, we say $B$ is sumfree with respect to $A$ if no element of $A$ is the sum of two distinct elements of $B$. Given $A$, we let $\phi(A)$ denote the largest sumfree subset with respect to $A$. We let $\phi(n)$ be the smallest value of $\phi(A)$ among all sets $A \subset \mathbf{R}$ of size $n$.

\begin{theorem}[Choi]
    If $A$ is any set of $n$ real numbers, there is a set $B \subset A$ of cardinality $\log n - O(1)$ sumfree with respect to $A$. Thus $\phi(n) \geq \log n - O(1)$.
\end{theorem}
\begin{proof}
    Assume first that $A$ is a subset of positive reals. Order $A = \{ a_1 > a_2 > \dots > a_n > 0 \}$. Consider the graph $G$ with vertices $A$, and edges $(a_n, a_m)$ if $a_n + a_m \in A$. By Tur\'{a}n's theorem, since $\deg(a_i) \leq n - i$, we find an independant set $S$ with
    %
    \[ |S| \geq \sum_{i = 1}^n \frac{1}{n - i + 1} = \sum_{i = 1}^n \frac{1}{i} = \log n - O(1) \]
    %
    In general, any set $A$ of $n$ real numbers either contains $n/2 - O(1)$ positive real numbers or $n/2 - O(1)$ negative real numbers, and the theorem then follows in this case.
\end{proof}

The $n/(d+1)$ bound for graphs of bounded degree $d$ cannot be improved for general graphs $G$. However, it is surprising that one can improve the bound by a $\log d$ factor, provided that the resultant graph has no three cycles.

\begin{theorem}
    If $G$ has no three cycles with maximal degree $d$, then $G$ contains an independant set of size $\Omega(n \log d / d)$.
\end{theorem}
\begin{proof}
    Choose a set $I$ uniformly from the set of all independant sets in $G$. For each $v \in V$, define the random variable
    %
    \[ X_v = d |I \cap \{ v \}| + |N(v) \cap I| = \begin{cases} d & v \in I \\ |N(v) \cap I| & v \not \in I \end{cases} \]
    %
    Any vertex can be in the neighbourhood of at most $d$ other vertices, so
    %
    \[ \sum_v X_v = d|I| + \sum_{v \not \in I} |N(v) \cap I| \leq 2d |I| \]
    %
    Taking expectations gives that
    %
    \[ \mathbf{E} |I| \geq \frac{1}{2d} \sum_v \mathbf{E}(X_v) \]
    %
    Thus it suffices to show that $\mathbf{E}(X_v)$ is large for each $v$. TODO: FINISH LATER.
\end{proof}

The Balog-Szemer\'{e}di theorem says that if $E(A,B) \geq K_0 n^2$ and $|A +_G B| \leq K_1 n$, then one can find $A_0 \subset A$ and $B_0 \subset B$ such that $|A_0|, |B_0|$, and $|A_0 + B_0|$ are $\Theta_{K_0,K_1}(n)$. Gower's recently strengthened the theorem to showing the constants in the bound are polynomial in $1/K_0$ and $K_1$. We shall find that this result can be converted into a graph problem.

If $E(A,B) \gtrsim |A|^{3/2} |B|^{3/2}$, then there is $A_0 \subset A$ and $B_0 \subset B$ with $|A_0| \sim |A|$, $|B_0| \sim |B|$, and $|A_0 + B_0| \lesssim |A_0|^{1/2} |B_0|^{1/2}$. In particular, if $A$ and $B$ have $n$ elements, and $E(A,B) \gtrsim n^3$, then there is $A_0 \subset A$ and $B_0 \subset B$ with $|A_0|, |B_0| \sim n$, and $|A_0 + B_0| \lesssim n$. Can we generalize this theorem to more general operations than addition, i.e. linear transformations of the coordinates?

\begin{lemma}
    If $G$ is a bipartite graph with $|E| \geq |A||B|/K$ for some $K \geq 1$, then for any $0 < \varepsilon < 1$, there is $A_0 \subset A$ such that $|A_0| \geq |A|/K \sqrt{2}$, and such that $1 - \varepsilon$ of the pairs of vertices in $A_0$ are connected by $\varepsilon |B|/ 2K^2$ paths of length 2 in $G$.
\end{lemma}
\begin{proof}
    By decreasing $K$, we may assume that $|E| = |A||B|/K$. Now
    %
    \[ \frac{\mathbf{E}_b |N(b)|}{|A|} = \frac{\mathbf{E}_a |N(a)|}{|B|} = \frac{|E|}{|A||B|} = \frac{1}{K} \]
    %
    and
    %
    \[ \frac{\mathbf{E}_b |N(b)|^2}{|A|^2}  = \mathbf{E}_{a,a'} \frac{|N(a) \cap N(a')|}{|B|} \]
\end{proof}

Let $A_1, \dots, A_k$ be additive sets with cardinality $n$, and consider a $k$ uniform $k$-partite hypergraph $H$ on $A_1, \dots, A_k$. If $H$ has $\Omega(n^k)$ edges and $|\bigoplus^H A_i| = O(n)$, then we can find $A_i' \subset A_i$ with $|A_i'| = \Omega(n)$ and $|A_1' + \dots + A_k'| = \Omega(n)$. If we let $H$ be 

\end{document}